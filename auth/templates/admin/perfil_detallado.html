{% extends 'base.html' %}
{% load static %}
{% block title %}Perfil Detallado{% endblock title %}
{% block content %}
<!-- start page title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box">
            <div class="page-title-right">
                {% if perfil.is_active %}
                <button type="button" class="btn btn-danger btn-sm mb-2" onclick="cambiarEstado({{ perfil.id }})">Desactivar</button>
                {% else %}
                <button type="button" class="btn btn-success btn-sm mb-2" onclick="cambiarEstado({{ perfil.id }})">Activar</button>
                {% endif %}
            </div>
            <h4 class="page-title">{{title}}</h4>
        </div>
    </div>
</div>
      
  <!-- end page title -->
<div class="row">
    <div class="col-xl-4 col-lg-5">
        <div class="card text-center">
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data" action="{% url 'actualizar_foto_perfil' usuario_id=perfil.id %}" id="form-foto">
                    {% csrf_token %}
                    
                    <div class="form-group text-center" style="position: relative;">
                        <!-- Contenedor para la imagen y el ícono -->
                        <div style="position: relative; display: inline-block;">
                            <!-- Foto de perfil -->
                            {% if colaborador.foto %}
                            <img src="{{ colaborador.foto.url }}" alt="Foto de perfil" class="rounded-circle img-thumbnail"id="foto-perfil" style="object-fit: cover; height:160px; width:160px">
                            {% else %}
                                <img src="{% static "images/avatar-1.svg" %}" alt="Foto de perfil" class="rounded-circle img-thumbnail" style="object-fit: cover; height:160px; width:160px" id="foto-perfil">
                            {% endif %}
                            
                            <!-- Icono de lápiz para cambiar foto en la esquina superior derecha -->
                            <label for="foto" class="btn btn-outline-secondary" style="width:30px;height:30px;position: absolute; top: 110px; right: -1px; cursor: pointer; border-radius: 50%; padding: 5px; background-color: #6c757d; transition: background-color 0.3s;">
                                <i class="ri-pencil-fill" style=" color: white; "></i>
                            </label>
                        </div>
                        
                        <!-- Input para subir imagen, oculto y activado por el botón -->
                        <input type="file" name="foto" accept="image/*" class="form-control" id="foto" style="display: none;" onchange="guardarImagen()">
                    </div>
                </form>
                
                

                <h4 class="mb-0 mt-2">{{ perfil.username }}</h4>
                <p class="text-muted font-14">{{ area.nom_are }}</p>

                <form method="POST" id="ratingForm">
                    {% csrf_token %}
                    
                    <!-- Campo oculto con el ID del colaborador -->
                    <input type="hidden" id="colaborador_id" value="{{ perfil.id }}" />
                    
                    <!-- Componente rateit para la calificación -->
                    <div class="rateit rateit-mdi" id="js-interaction" 
                         data-rateit-min="0" 
                         data-rateit-max="5" 
                         data-rateit-mode="font" 
                         data-rateit-step="0.5">
                    </div>
                
                    <!-- Mostrar la calificación seleccionada -->
                    <div style="display:none" >
                        <span id="jsvalue"></span>
                    </div>
                </form>
                
                
          
                <div class="text-start mt-3">
                    <h4 class="font-13 text-uppercase">Biográfia :</h4>
                    <p class="text-muted font-13 mb-3">
                        {{ colaborador.biografia|default:''}}
                    </p>
                    <p class="text-muted mb-2 font-13"><strong>Nombre Completo:</strong> <span class="ms-2">{{ perfil.first_name|default:'' }} {{ perfil.last_name|default:'' }}</span></p>

                    <p class="text-muted mb-2 font-13"><strong>Teléfono :</strong><span class="ms-2">{{ colaborador.telefono|default:'' }}</span></p>

                    <p class="text-muted mb-2 font-13"><strong>Email :</strong> <span class="ms-2 ">{{ perfil.email|default:'' }}</span></p>

                    <p class="text-muted mb-2 font-13"><strong>Dirección :</strong> <span class="ms-2">{{ colaborador.direccion|default:'' }}</span></p>
                    <p class="text-muted mb-1 font-13"><strong>Fecha de Creación:</strong> <span class="ms-2">{{ perfil.date_joined|default:''|date:"Y-m-d" }}</span></p>

                </div>
            </div> <!-- end card-body -->
        </div> <!-- end card -->

    </div> <!-- end col-->

    <div class="col-xl-8 col-lg-7">
        <div class="card">
            <div class="card-body">
                <ul class="nav nav-pills bg-nav-pills nav-justified mb-3">
                    <li class="nav-item">
                        <!-- Hacer que el enlace esté activo por defecto -->
                        <a href="#settings" data-bs-toggle="tab" aria-expanded="false" class="nav-link rounded-0 active">
                            Configuración
                        </a>
                        <li class="nav-item">
                            <a href="#contrato" data-bs-toggle="tab" aria-expanded="false" class="nav-link rounded-0">
                                Contrato
                            </a>
                        </li>
                    </li>
                </ul>
                <div class="tab-content">
                
                    <!-- Hacer que la tab esté activa por defecto -->
                    <div class="tab-pane active" id="settings">
                        <form method="POST" action="{% url 'actualizar_perfil'  usuario_id=colaborador.user.id %}">
                            {% csrf_token %}
                            <h5 class="mb-3 text-uppercase bg-light p-2"><i class="mdi mdi-account-circle me-1"></i> Información Personal</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="firstname" class="form-label">Nombres</label>
                                        <input type="text" class="form-control" id="firstname" placeholder="Nombres" name="firstname" value="{{ perfil.first_name|default:''  }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="lastname" class="form-label">Apellidos</label>
                                        <input type="text" class="form-control" id="lastname" placeholder="Apellidos" name="lastname"value="{{ perfil.last_name|default:''  }}">
                                    </div>
                                </div> <!-- end col -->
                            </div> <!-- end row -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="userbio" class="form-label">Biografía</label>
                                        <textarea name="biografia" class="form-control" id="biografia" rows="4" placeholder="Escribe tu biografía......">{{ colaborador.biografia|default:'' }}</textarea>
                                    </div>
                                </div> <!-- end col -->
                            </div> <!-- end row -->                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="dni" class="form-label">DNI</label>
                                        <input type="text" class="form-control" id="dni" placeholder="DNI" name="dni" 
                                        value="{{ colaborador.dni|default:'' }}" maxlength="8" pattern="\d{8}" 
                                        title="Por favor ingrese 8 dígitos numéricos.">                         
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="fec_nac" class="form-label">Fecha de Nacimiento</label>
                                        <input type="date" class="form-control" id="fec_nac" name="fec_nac" value="{{ colaborador.nacimiento|date:'Y-m-d' }}">
                                    </div>
                                </div> <!-- end col -->
                            </div> <!-- end row -->
    
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="useremail" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="useremail" placeholder="Enter email" name="useremail"  
                                        value="{{ perfil.email|default:'' }}" 
                                        title="Por favor ingrese un correo electrónico válido con los dominios @gmail.com, @hotmail.com, o @outlook.com." >
                                    </div>                                    
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="telefono" class="form-label">Teléfono</label>
                                        <input type="tel" class="form-control" id="telefono" placeholder="999999999" name="telefono" 
                                        value="{{ colaborador.telefono|default:'' }}"  maxlength="9"
                                        pattern="^\d{9}$" 
                                        title="Por favor ingrese exactamente 9 dígitos numéricos.">
                                    </div>
                                    
                                </div>
                            </div> <!-- end row -->  
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <label for="direccion" class="form-label">Dirección</label>
                                        <input class="form-control" id="direccion" rows="4" placeholder="Av......" name="direccion" value="{{ colaborador.direccion|default:''  }}"></input>
                                    </div>
                                </div> <!-- end col -->
                            </div> <!-- end row -->  
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="tip_cuenta" class="form-label">Tipo de Cuenta</label>
                                        <select class="form-select form-control" id="tip_cuenta" name="tip_cuenta">
                                            <option value="BCP" {% if colaborador.tip_cuenta == 'BCP' %}selected{% endif %}>BCP</option>
                                            <option value="CCI Interbank" {% if colaborador.tip_cuenta == 'CCI Interbank' %}selected{% endif %}> CCI Interbank</option>
                                            <option value="CCI BBVA" {% if colaborador.tip_cuenta == 'CCI BBVA' %}selected{% endif %}>CCI BBVA</option>
                                            <option value="CCI Scotiabank" {% if colaborador.tip_cuenta == 'CCI Scotiabank' %}selected{% endif %}>CCI Scotiabank</option>
                                            <option value="CCI Banco de la Nación" {% if colaborador.tip_cuenta == 'CCI Banco de la Nación' %}selected{% endif %}>CCI Banco de la Nación</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="num_cuenta" class="form-label">Número de Cuenta</label>
                                        <input type="text" class="form-control" id="num_cuenta" placeholder="000-000-000-000" name="num_cuenta" value="{{ colaborador.num_cuenta|default:''  }}">
                                    </div>
                                </div>
                            </div> <!-- end row -->  
                            <h5 class="mb-3 text-uppercase bg-light p-2"><i class=" uil-exclamation-circle fs-4"></i> Contacto de Emergencia</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="nom_emergencia" class="form-label">Nombres y Apellidos</label>
                                        <input type="text" class="form-control" id="nom_emergencia" placeholder="Nombres y Apellidos" name="nom_emergencia" value="{{ colaborador.nom_emergencia|default:''  }}">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="telf_emergencia" class="form-label">Teléfono</label>
                                        <input type="tel" class="form-control" id="telf_emergencia" placeholder="999999999" name="telf_emergencia" 
                                        value="{{ colaborador.telf_emergencia|default:'' }}"  maxlength="9"
                                        pattern="^\d{9}$" 
                                        title="Por favor ingrese exactamente 9 dígitos numéricos.">
                                    </div>
                                    
                                </div>
                            </div> <!-- end row -->
                            <h5 class="mb-3 text-uppercase bg-light p-2"><i class="mdi mdi-office-building me-1"></i> Información Empresa</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="area-select" class="form-label">Área</label>
                                        <!-- Solo el select que se llenará con las áreas -->
                                        <select class="form-select form-control" id="area-select" name="id_are">
                                            <option value="" disabled selected>Seleccione un área</option>
                                            <!-- Las opciones se cargarán aquí mediante JavaScript -->
                                        </select>
                                    </div>
                                    
                                </div>
                            
                                
                            </div> <!-- end row -->
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-3">
                                        <input type="checkbox" class="form-check-input" name="is_superuser" {% if colaborador.id_user.is_superuser %}checked{% endif %}>
                                        <label class="form-label">¿Es administrador?</label>
                                    </div>
                                </div> <!-- end col -->
                            </div> <!-- end row -->  
                            <div class="d-flex justify-content-between align-items-center">
                                <!-- Enlace de Cambiar Contraseña alineado a la izquierda -->
                                <div class="text-start">
                                    <a type="button" class="btn btn-light" href="{% url 'cambiar_contrasena_equipo' usuario_id=perfil.id %}">
                                        <i class="mdi mdi-account-edit me-1"></i> Cambiar Contraseña
                                    </a>
                                </div>
                            
                                <!-- Botón de Save alineado a la derecha -->
                                <div class="text-end">
                                    <button type="submit" class="btn btn-success">
                                        <i class="mdi mdi-content-save"></i> Guardar
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- end settings content-->
                    <!-- Historial de Contratos -->
                    <div class="tab-pane" id="contrato">
                        <h5 class="mb-3 text-uppercase bg-light p-2"><i class="mdi mdi-briefcase me-1"></i> Historial de Contratos</h5>
                        <!-- Botón para abrir el modal de añadir contrato -->
                        <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#mdlAddContrato">
                            <i class="uil uil-plus me-1"></i> Añadir Contrato
                        </button>

                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Fecha de Inicio</th>
                                        <th>Fecha de Fin</th>
                                        <th>Duración</th>
                                        <th>Sueldo</th>
                                        <th>Cargo</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for contrato in contratos %}
                                    <tr data-id="{{ contrato.id }}">
                                            <td>{{ contrato.inicio|date:"d/m/Y" }}</td>
                                            <td>{{ contrato.fin|date:"d/m/Y" }}</td>
                                            <td>{{ contrato.duracion }}</td>
                                            <td>{{ contrato.sueldo }}</td>
                                            <td>{{ contrato.cargo }}</td>
                                            <td>
                                                <div class="dropdown card-widgets">
                                                    <a href="#" class="dropdown-toggle arrow-none" data-bs-toggle="dropdown" aria-expanded="false">
                                                        <i class="uil uil-ellipsis-h"></i>
                                                    </a>
                                                    <div class="dropdown-menu dropdown-menu-end">
                                                        <a href="javascript:void(0);" class="dropdown-item edit" 
                                                        data-id="{{ contrato.id }}"
                                                        data-cargo="{{ contrato.cargo }}"
                                                         data-duracion="{{ contrato.duracion}}"
                                                        data-inicio="{{ contrato.inicio|date:'Y-m-d' }}"
                                                        data-fin="{{ contrato.fin|date:'Y-m-d' }}"
                                                        data-sueldo="{{ contrato.sueldo }}">
                                                            <i class="uil uil-edit me-1"></i>Editar
                                                        </a>
                                                        <!-- Enlace de eliminar -->
                                                        <a href="javascript:void(0);" class="dropdown-item text-danger delete" data-bs-toggle="modal" data-bs-target="#mdlDelete">
                                                            <i class="uil uil-trash-alt me-1"></i>Eliminar
                                                        </a>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    {% empty %}
                                        <tr>
                                            <td colspan="4">No hay contratos registrados para este colaborador.</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>


                </div> <!-- end tab-content -->
            </div> <!-- end card body -->
        </div> <!-- end card -->
    </div> <!-- end col -->
    
</div>
<!-- Modal Añadir Contrato -->
<div id="mdlAddContrato" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="addContratoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="addContratoModalLabel">Añadir Nuevo Contrato</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
            </div>
            <div class="modal-body">
                <form id="addContratoForm">
                    {% csrf_token %}
                    <input type="hidden" id="id_user" value="{{ perfil.id }}">
                    <div class="mb-3">
                        <label for="inicio" class="form-label">Fecha de Inicio</label>
                        <input type="date" class="form-control" id="inicio" name="inicio" required>
                    </div>
                    <div class="mb-3">
                        <label for="fin" class="form-label">Fecha de Fin</label>
                        <input type="date" class="form-control" id="fin" name="fin" required>
                    </div>
                    <div class="mb-3">
                        <label for="sueldo" class="form-label">Sueldo</label>
                        <input type="number" step="0.01" class="form-control" id="sueldo" name="sueldo" required>
                    </div>
                    <div class="mb-3">
                        <label for="cargo" class="form-label">Cargo</label>
                        <input type="text" class="form-control" id="cargo" name="cargo" required>
                    </div>
                    <div class="mb-3">
                        <label for="duracion" class="form-label">Duración</label>
                        <input type="text" class="form-control" id="duracion" name="duracion" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Añadir Contrato</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
  
<!-- Modal Eliminar -->
<div id="mdlDelete" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="standard-modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="standard-modalLabel">Eliminar</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
            </div>
            <input type="hidden" id="contratoId" name="id">
            <div class="modal-body">
                <p>¿Estás seguro de que quieres eliminar este contrato?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                <!-- Asegúrate de agregar el atributo data-id al botón de eliminar -->
                <button type="button" class="btn btn-danger btnBorrar" data-id="">Eliminar</button>
            </div>
        </div>
    </div>
</div>

<!-- end row-->
{% endblock %} {% block scripts %}

<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        // Obtener todos los botones de edición
        const editButtons = document.querySelectorAll('.edit');
        
        editButtons.forEach(button => {
            button.addEventListener('click', function() {
                const contratoId = this.getAttribute('data-id');
                const cargo = this.getAttribute('data-cargo');
                const duracion = this.getAttribute('data-duracion');
                const inicio = this.getAttribute('data-inicio');
                const fin = this.getAttribute('data-fin');
                const sueldo = this.getAttribute('data-sueldo');
        
                // Colocar los datos en los campos del modal (ahora con los nuevos IDs)
                document.getElementById('contratoId').value = contratoId;
                document.getElementById('cargoEdit').value = cargo;
                document.getElementById('duracionEdit').value = duracion;
                document.getElementById('inicioEdit').value = inicio;
                document.getElementById('finEdit').value = fin;
                document.getElementById('sueldoEdit').value = sueldo;
        
                const myModal = new bootstrap.Modal(document.getElementById('editarContratoModal'));
                myModal.show();
            });
        });

   // Seleccionamos todos los botones de "Eliminar"
   const deleteButtons = document.querySelectorAll('.delete');
    
   // Cuando se hace clic en el enlace de eliminar, abrimos el modal
   deleteButtons.forEach(button => {
       button.addEventListener('click', function() {
           // Obtener el ID del contrato desde el "tr" que contiene el "data-id"
           const contratoId = this.closest('tr').getAttribute('data-id');
           
           // Seteamos el ID del contrato al botón de eliminar
           const btnBorrar = document.querySelector('.btnBorrar');
           btnBorrar.setAttribute('data-id', contratoId);

           // Mostramos el modal
           const myModal = new bootstrap.Modal(document.getElementById('mdlDelete'));
           myModal.show();
       });
   });

   // Acción cuando se presiona el botón "Eliminar"
   const btnBorrar = document.querySelector('.btnBorrar');
   if (btnBorrar) {
       btnBorrar.addEventListener('click', function() {
           // Obtener el ID del contrato
           const contratoId = this.getAttribute('data-id');
           
           // Obtener el token CSRF desde el DOM (asegúrate de que tienes el token en tu plantilla HTML)
           const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

           // Realizamos la solicitud fetch para eliminar el contrato
           fetch(`../../eliminar-contrato/${contratoId}/`, {
               method: 'DELETE',
               headers: {
                   'Content-Type': 'application/json',
                   'X-CSRFToken': csrfToken  // Incluimos el token CSRF en la cabecera
               }
           })
           .then(response => response.json())
           .then(data => {
               if (data.success) {
                   // Si la eliminación fue exitosa, mostramos un mensaje y recargamos la página
                   alert('Contrato eliminado con éxito');
                   location.reload();
               } else {
                   // Si hubo un error, mostramos un mensaje
                   alert('Hubo un error al eliminar el contrato');
               }
           })
           .catch(error => {
               console.error('Error:', error);
               alert('Error en la solicitud de eliminación');
           });
       });
   }
    });
    $(document).ready(function() {
        // Obtener la calificación inicial desde el servidor
        var calificacionInicial = {{ colaborador.calificacion|default:0  }};
    
        // Inicializamos rateit y establecemos el valor inicial
        $('#js-interaction').rateit().rateit('value', calificacionInicial);
    
        // Mostrar el valor inicial
        $('#jsvalue').text(calificacionInicial);
    
        // Escuchar cuando cambia la calificación
        $('#js-interaction').on('rated', function() {
            var value = $(this).rateit('value'); // Obtener el valor directamente
    
            console.log('Calificación seleccionada: ' + value);
    
            $('#jsvalue').text(value);
    
            var colaboradorId = $('#colaborador_id').val();
    
            if (value) {
                $.ajax({
                    url: '{% url "guardar_calificacion" %}',
                    type: 'POST',
                    data: {
                        'rating': value,
                        'colaborador_id': colaboradorId,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(response) {
                        console.log('Calificación guardada:', response);
                    },
                    error: function(xhr, status, error) {
                        console.error('Error al guardar la calificación:', xhr.responseText);
                    }
                });
            } else {
                console.log("Calificación no válida.");
            }
        });
    });
    
    
    // Función que envía el formulario automáticamente cuando se selecciona una nueva imagen
    function guardarImagen() {
        // Enviar el formulario automáticamente
        document.getElementById('form-foto').submit();
    }



    // Llamada a la API para obtener las áreas
    $.get("{% url 'area-list' %}", function (data) {
        let areas = data.results;  // Si los datos no están paginados, usarlos directamente
        var userAreaId = {{ area.id|default:"null"|escapejs }};
				console.log("ID de Área del usuario:", userAreaId);
        // Verificar si ya tiene áreas cargadas o si ya tiene la opción predeterminada
        let areaSelect = $("#area-select");
        
        // Si no tiene un área asignada, asegurarse de que la opción predeterminada esté
        if (userAreaId === "null" || userAreaId === "") {
            if (areaSelect.find('option[value=""]').length === 0) {
                areaSelect.append('<option value="" disabled selected>Seleccione un área</option>');
            }
        }
        
        // Llenar el select con todas las áreas
        areas.forEach((areaItem) => {
            let selected = (areaItem.id === userAreaId) ? 'selected' : '';  // Si tiene un área asignada, marcarla como seleccionada
            let option = `<option value="${areaItem.id}" ${selected}>${areaItem.nombre}</option>`;
            areaSelect.append(option);
        });
    }).fail(function (error) {
        console.error("Error al cargar áreas:", error);
    });
    function cambiarEstado(userId) {
        var url = "{% url 'cambiar_estado' %}";  // Define la URL para cambiar el estado en tu archivo urls.py
    
        // Hacer la solicitud Ajax para cambiar el estado
        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                'user_id': userId
            })
        })
        .then(response => response.json())
        .then(data => {
            // Si el estado cambia correctamente, actualiza el botón
            if (data.success) {
                location.reload();  // Recarga la página para reflejar el cambio
            } else {
                alert('Error al cambiar el estado');
            }
        })
        .catch(error => console.error('Error:', error));
    }
    </script>
{% endblock %}
